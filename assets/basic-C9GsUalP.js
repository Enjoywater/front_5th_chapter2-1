import"./modulepreload-polyfill-B5Qt9EMX.js";const E=document.createElement("div"),y=document.createElement("div"),I=document.createElement("h1"),C=document.createElement("div"),f=document.createElement("div"),x=document.createElement("select"),h=document.createElement("button"),A=document.createElement("div"),o={elements:{container:E,wrapper:y,header:I,cartItemContainer:C,summary:f,select:x,addProductButton:h,stockInfo:A},getElement:t=>o.elements[t],appendElement:(t,e)=>{o.getElement(t).appendChild(e)},setElementId:({element:t,id:e})=>{o.getElement(t).setAttribute("id",e)},setElementClass:({element:t,classes:e})=>{o.getElement(t).classList.add(...e)},initializeElements:()=>{o.setElementId({element:"cartItemContainer",id:"cart-items"}),o.setElementId({element:"summary",id:"cart-total"}),o.setElementId({element:"select",id:"product-select"}),o.setElementId({element:"addProductButton",id:"add-to-cart"}),o.setElementId({element:"stockInfo",id:"stock-status"}),o.setElementClass({element:"container",classes:["bg-gray-100","p-8"]}),o.setElementClass({element:"wrapper",classes:["max-w-md","mx-auto","bg-white","rounded-xl","shadow-md","overflow-hidden","md:max-w-2xl","p-8"]}),o.setElementClass({element:"summary",classes:["text-xl","font-bold","my-4"]}),o.setElementClass({element:"select",classes:["border","rounded","p-2","mr-2"]}),o.setElementClass({element:"addProductButton",classes:["bg-blue-500","text-white","px-4","py-2","rounded"]}),o.setElementClass({element:"stockInfo",classes:["text-sm","text-gray-500","mt-2"]}),o.getElement("header").textContent="장바구니",o.getElement("addProductButton").textContent="추가"},buildDOMStructure:()=>(["header","cartItemContainer","summary","select","addProductButton","stockInfo"].forEach(e=>{o.appendElement("wrapper",o.getElement(e))}),o.appendElement("container",o.getElement("wrapper")),o.getElement("container"))},P=[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],c={items:P,getAll:()=>c.items,getById:t=>c.items.find(e=>e.id===t),getRandomItem:()=>c.items[Math.floor(Math.random()*c.items.length)],getSuggestedProduct:t=>c.items.find(e=>e.id!==t&&e.quantity>0),getDiscountRate:t=>{switch(t){case"p1":return .1;case"p2":return .15;case"p3":return .2;case"p4":return .05;case"p5":return .25;default:return 0}},updateQuantity:(t,e)=>{const n=c.getById(t);n&&n.quantity+e>=0&&(n.quantity+=e)},applyDiscount:(t,e)=>{const n=c.getById(t);n&&(n.price=Math.round(n.price*(1-e)))}},s={state:{lastSelectedProductId:null,totalAmount:0,itemCount:0},getLastSelectedProductId:()=>s.state.lastSelectedProductId,getTotalAmount:()=>s.state.totalAmount,getItemCount:()=>s.state.itemCount,setLastSelectedProductId:t=>{s.state.lastSelectedProductId=t},setTotalAmount:t=>{s.state.totalAmount=t},setItemCount:t=>{s.state.itemCount=t},resetCalculation:()=>{s.state.totalAmount=0,s.state.itemCount=0}},m=1e3,T=60*m,b={TUESDAY:2},S=()=>{let t="";c.getAll().forEach(({name:e,quantity:n})=>{const a=n===0,l=n>0&&n<5;a&&(t+=`${e}: 품절`),l&&(t+=`${e}: 재고 부족 (${n}개 남음)`)}),o.getElement("stockInfo").textContent=t},v=()=>{const t=Math.floor(s.getTotalAmount()/1e3),e=()=>{const n=document.getElementById("loyalty-points");if(n)return n;const a=document.createElement("span");return a.id="loyalty-points",a.className="text-blue-500 ml-2",o.appendElement("summary",a),a};e().textContent=`(포인트: ${t})`},D=(t,e)=>{let n=0;return Array.from(t).forEach(a=>{let l;e.forEach(d=>{d.id===a.id&&(l=d)});const i=parseInt(a.querySelector("span").textContent.split("x ")[1]),r=l.price*i,u=i>=10?c.getDiscountRate(l.id):0;n+=r,s.setItemCount(s.getItemCount()+i),s.setTotalAmount(s.getTotalAmount()+r*(1-u))}),n},w=t=>{let e=0;const n=s.getTotalAmount()*.25,a=t-s.getTotalAmount();return s.getItemCount()>=30&&n>a?(s.setTotalAmount(s.getTotalAmount()*(1-.25)),e=.25):e=a/t,new Date().getDay()===b.TUESDAY&&(s.setTotalAmount(s.getTotalAmount()*(1-.1)),e=Math.max(e,.1)),e},$=t=>{if(!t)return;const e=document.createElement("span");e.className="text-green-500 ml-2",e.textContent=`(${(t*100).toFixed(1)}% 할인 적용)`,o.appendElement("summary",e)},p=()=>{s.resetCalculation();const t=c.getAll(),e=o.getElement("cartItemContainer").children,n=D(e,t),a=w(n);o.getElement("summary").textContent=`총액: ${Math.round(s.getTotalAmount())}원`,$(a),S(),v()},g=()=>{o.getElement("select").innerHTML="",c.getAll().forEach(({id:t,name:e,price:n,quantity:a})=>{const l=document.createElement("option");l.value=t,l.textContent=`${e} - ${n}원`,l.disabled=a===0,o.appendElement("select",l)})},q=t=>t.classList.contains("quantity-change")||t.classList.contains("remove-item"),B=({newQuantity:t,product:e,currentQuantity:n})=>t>0&&t<=e.quantity+n,L=t=>parseInt(t.querySelector("span").textContent.split("x ")[1]),R=(t,e)=>{const n=t.querySelector("span"),a=`${n.textContent.split("x ")[0]}x `;n.textContent=`${a}${e}`},M=({target:t,targetElement:e,targetProduct:n,productId:a,currentQuantity:l})=>{const i=parseInt(t.dataset.change),r=l+i;B({newQuantity:r,product:n,currentQuantity:l})?(R(e,r),c.updateQuantity(a,-i)):r<=0?(e.remove(),c.updateQuantity(a,-i)):alert("재고가 부족합니다.")},Q=({targetElement:t,productId:e,currentQuantity:n})=>{c.updateQuantity(e,n),t.remove()},k=t=>{const{target:e}=t;if(!q(e))return;const n=e.dataset.productId,a=document.getElementById(n),l=c.getById(n),i=L(a),r=e.classList.contains("quantity-change"),u=e.classList.contains("remove-item");r&&M({target:e,targetElement:a,targetProduct:l,productId:n,currentQuantity:i}),u&&Q({targetElement:a,productId:n,currentQuantity:i}),p()},O=t=>t&&t.quantity>0,N=(t,e)=>{const n=t.firstElementChild,l=parseInt(n.textContent.split("x ")[1])+1,{id:i,name:r,price:u,quantity:d}=e;d>0&&(n.textContent=`${r} - ${u}원 x ${l}`,c.updateQuantity(i,-1))},H=t=>{const e=document.createElement("div");return e.id=t.id,e.className="flex justify-between items-center mb-2",e.innerHTML=_(t),e},U=t=>{const e=H(t);o.appendElement("cartItemContainer",e),c.updateQuantity(t.id,-1)},_=({id:t,name:e,price:n})=>`<span>${e} - ${n}원 x 1</span><div><button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t}" data-change="-1">-</button><button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t}" data-change="1">+</button><button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${t}">삭제</button></div>`,W=()=>{const t=o.getElement("select").value,e=c.getById(t);if(!O(e)){alert("재고가 부족합니다.");return}const n=document.getElementById(e.id);n?N(n,e):U(e),p(),s.setLastSelectedProductId(t)},Y=()=>{const t=c.getRandomItem(),{name:e,id:n,quantity:a}=t;Math.random()<.3&&a>0&&(c.applyDiscount(n,.2),alert(`번개세일! ${e}이(가) 20% 할인 중입니다!`),g())},z=()=>{const t=s.getLastSelectedProductId();if(t){const e=c.getSuggestedProduct(t),{name:n,id:a}=e;e&&(alert(`${n}은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!`),c.applyDiscount(a,.05),g())}},F=()=>setTimeout(()=>setInterval(Y,30*m),10*m),j=()=>setTimeout(()=>setInterval(z,1*T),20*m);function K(){const t=document.getElementById("app");o.initializeElements(),g(),t.appendChild(o.buildDOMStructure()),p(),F(),j()}K();o.getElement("addProductButton").addEventListener("click",W);o.getElement("cartItemContainer").addEventListener("click",k);
